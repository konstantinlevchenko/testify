<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Using AnonymousData </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Using AnonymousData ">
    <meta name="generator" content="docfx 2.32.2.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/font-awesome.min.css">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" src="../images/gavel_icon-64x64.png" height="46" width="46" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="UsingAnonymousData">
              <h1 id="using-anonymousdata">Using AnonymousData</h1>
              
<p>It&#39;s vital that unit tests be written to make what is being tested as completely comprehensible as possible.
Extra &quot;noise&quot; in tests make it harder to understand the test &quot;at a glance&quot;. When code is modified that results
in failing unit tests, any impediment to understanding what is being tested and why it failed is very detrimental
to the development workflow. If a developer has to spend too much time figuring out how to fix their code or
update a test to make it pass again they are likely to give up in frustration and make incorrect test changes
or worse, disable the test. So, if unit tests are to be seen as beneficial instead of detrimental to developer
productivity, tests have to be easily understood.</p>
<p>One of the biggest factors in making a unit test difficult to understand is lengthy and complex setup (arrange
in AAA) code. It&#39;s not uncommon for a test to need to create lots of objects and set many properties before
the test&#39;s Act phase. Often, most of this setup is just ceremony, and not really relevant to what&#39;s being
tested. For example, to test a Search method on a custom collection you&#39;d have to first create the collection
and populate it with items. Ensuring the collection contains a specific item to search for is relevant here,
but the rest of the collection&#39;s items really aren&#39;t. They are necessary, but what items are added doesn&#39;t
make any real difference to the outcome of the test. This is a very simple example, but you can imagine many
other more complex scenarios where the majority of the test setup is necessary but not directly related to
the behavior of the test.</p>
<p>This is where @Testify.AnonymousData comes in. <code>AnonymousData</code> is a general purpose object factory specfically
designed to create &quot;random&quot; objects for unit testing. Random may sound like a bad thing. After all, you don&#39;t
want random behavior in your tests. However, the random objects created here are very specifically for things
that are needed to execute a test, but that won&#39;t effect the outcome of the test. This actually provides
another benefit, by clearly stating in the test what portions of the setup are relevant and what portions are
necessary but do not effect the outcome of the test.</p>
<p>Here&#39;s a typical usage example:</p>
<pre><code class="lang-csharp" name="Simple AnonymousData Example">using System.Collections.Generic;
using System.Linq;
using Testify;
using Xunit;
using static Testify.Assertions;

namespace Examples.UsingAnonymousData
{
    public class SimpleExample
    {
        [Fact]
        public void IndexOf_ItemInList_ShouldReturnIndex()
        {
            const int item = 10;
            var anon = new AnonymousData();
            var front = anon.AnyEnumerable&lt;int&gt;().ToArray();
            var back = anon.AnyEnumerable&lt;int&gt;().ToArray();
            var list = new List&lt;int&gt;(front)
            {
                item,
            };
            list.AddRange(back);

            var index = list.IndexOf(item);

            Assert(index).IsEqualTo(front.Length);
        }
    }
}
</code></pre><h2 id="registering-factories">Registering Factories</h2>
<p><code>AnonymousData</code> knows how to create random primitive values, as well as several other common data types such
as <code>DateTime</code>. For types that it doesn&#39;t know about it will try and create a random instance by using the
type&#39;s public constructor with the fewest parameters, and creating random values for those parameters.
This means that most types can be randomly created by <code>AnonymousData</code> &quot;out of the box&quot;. However, some types
may not be creatable using this simple strategy, or you may need more control over how the object is created.
In these scenarios it&#39;s possible to register a factory callback with the <code>AnonymousData</code> instance that
will be used any time you need an instance of that type.</p>
<p>Here&#39;s an example:</p>
<pre><code class="lang-csharp" name="Register Example">using Testify;
using Xunit;
using static Testify.Assertions;

namespace Examples.UsingAnonymousData
{
    public class RegisterExample
    {
        [Fact]
        public void FullName_ShouldBeCalculated()
        {
            var anon = new AnonymousData();
            anon.Register&lt;Person&gt;(f =&gt; new Person(f.AnyFirstName(), f.AnySurname()));
            var person = anon.Any&lt;Person&gt;();

            var fullName = person.FullName;

            Assert(fullName).IsEqualTo($&quot;{person.LastName}, {person.FirstName}&quot;);
        }
    }
}
</code></pre><p>In addition to registering factories with a specific instance you may also register default factories to use
with all instances of <code>AnonymousData</code>, by using the static <code>RegisterDefault</code> method.</p>
<pre><code class="lang-csharp" name="Register Example">using Testify;
using Xunit;
using static Testify.Assertions;

namespace Examples.UsingAnonymousData
{
    public class RegisterDefaultExample
    {
        // Use whatever the appropriate &quot;assembly initialize&quot; logic your
        // unit test framework uses.
        static RegisterDefaultExample() =&gt;
            AnonymousData.RegisterDefault&lt;Employee&gt;(
                anon =&gt; new Employee(anon.AnyFirstName(), anon.AnySurname(), anon.AnyBool()));

        [Fact]
        public void FullName_ShouldBeCalculated()
        {
            var anon = new AnonymousData();
            var employee = anon.Any&lt;Employee&gt;();

            var fullName = employee.FullName;

            Assert(fullName).IsEqualTo($&quot;{employee.LastName}, {employee.FirstName}&quot;);
        }
    }
}
</code></pre><p>It&#39;s also often useful to have multiple ways to create an anonymous object. For instance, there are ways
to control the minimum and maximum values or random <code>Int32</code> instances created by calling the <code>AnyInt32</code>
extension method. You can define your own extension methods for your specific types as well. It&#39;s always
a good practice to register one of your extension methods as a factory callback as well. When creating
an object that has no registered factory it&#39;s always done by using registered factories to create any
data necessary during construction: extension methods won&#39;t be called unless they are registered. Only
one such factory may be registered at one time, with the last callback registered being the only callback
registered.</p>
<pre><code class="lang-csharp" name="Register Example">using System;
using System.ComponentModel;
using Testify;

namespace Examples.UsingAnonymousData
{
    [EditorBrowsable(EditorBrowsableState.Never)]
    public static class AnonymousPerson
    {
        public static Person AnyFemalePerson(this AnonymousData anon)
        {
            if (anon == null)
            {
                throw new ArgumentNullException(nameof(anon));
            }

            return new Person(anon.AnyFirstName(false), anon.AnySurname());
        }

        public static Person AnyMalePerson(this AnonymousData anon)
        {
            if (anon == null)
            {
                throw new ArgumentNullException(nameof(anon));
            }

            return new Person(anon.AnyFirstName(true), anon.AnySurname());
        }

        public static Person AnyPerson(this AnonymousData anon)
        {
            if (anon == null)
            {
                throw new ArgumentNullException(nameof(anon));
            }

            return new Person(anon.AnyFirstName(), anon.AnySurname());
        }
    }
}
</code></pre><p>In general, if only one test needs it, register the factory callback on an <code>AnonymousData</code> instance
created in that test. If multiple tests in a single test class will need it, either use a helper
method to create the instance, or create a member instance using your test frameworks test class
setup functionality, and register the factory there. If more than one test class will need to use
the factory, register it in your test framework&#39;s test assembly setup, and use <code>RegisterDefault</code>
to register it for all <code>AnonymousData</code> instances.</p>
<h2 id="populating-instances">Populating instances</h2>
<p>In some scenarios you may need to do more than just create random instances. You may need to populate
all the public properties of those instances with random values as well. This can be done either
shallowly (only the properties on the instance) or deeply (properties on the instance and properties
those values, all the way down the property chain). There are overloads of <code>Any</code> that take a
<code>PopulationOption</code> enumeration value to create and populate an instance in one call, as well as <code>Populate</code>
overloads you can call to populate an existing object instance.</p>
<p>Sometimes you need control over how a type is populated, so there are <code>Register</code> and <code>RegisterDefault</code>
methods that allow you to specify how a specific property is to be populated.</p>
<div class="NOTE"><h5>Note</h5><p>While most types can be created by <code>AnonymousData</code> out of the box, you will likely find that many
cannot be successfully populated requiring more configuration to specify how specific properties
need to be populated.</p>
</div>
<p>Here&#39;s an example of using <code>Populate</code>:</p>
<pre><code class="lang-csharp" name="Register Example">using Testify;
using Xunit;
using static Testify.Assertions;

namespace Examples.UsingAnonymousData
{
    public class PopulateExample
    {
        [Fact]
        public void Map_ShouldMapFullName()
        {
            var anon = new AnonymousData();
            var dto = anon.Any&lt;EmployeeDto&gt;();
            anon.Populate(dto);
            var mapper = new Mapper();

            var employee = mapper.Map&lt;Employee&gt;(dto);

            Assert(employee.FullName).IsEqualTo($&quot;{dto.LastName}, {dto.FirstName}&quot;);
        }
    }
}
</code></pre>
            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/wekempf/testify/blob/master/docs/manual/UsingAnonymousData.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2016 William E. Kempf<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
